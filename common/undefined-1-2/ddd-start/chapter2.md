---
description: 이 글은 최범균 저자님의 DDD-START의 정리입니다.
---

# Chapter2 아키텍쳐 개요

## 항목

* 아키텍쳐
* DIP
* 도메인 영역의 주요 구성요소
* 인프라스트럭쳐
* 모듈

### 네 개의 영역

아키텍쳐의 정형적인 영역은 표현, 응용, 도메인, 인프라스트럭처 이다.

* 표현영역 : 
  * 사용자의 요청을 받아 응용 영역에 전달하고 응용 영역의 처리 결과를 다시 사용자에게 보여주는 역할. ex\) 스프링 MVC
* 응용영역 : 
  * 표현 영역을 통해 사용자의 요청을 전달받는 응용 영역은 시스템이 사용자에게 제공해야 할 기능을 구현한다.  
  * 응용 영역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.
  * 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다.
* 도메인 영역 : 
  * 도메인 모델을 구현한다.
  * 도메인의 핵심 로직을 구현한다.
* 인프라스트럭쳐 영역 : 
  * 구현 기술에 대한 것을 다룬다.
  * RDBMS, 메세징 큐에 메시지를 전송하거나 수신하는 기능 구현, 몽고 DB나 HBASE를 사용해서 데이터베이스 연동을 처리한다.
  * 논리적인 개념을 표현하기보다는 실제 구현을 다룬다.

### 계층 구조 아키텍쳐

계층 구조는 그 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.

### DIP

고수준 모듈이 저수준 모듈을 사용하려면 고수준 모듈이 저수준 모듈에 의존해야 하는데, 반대로 저수준 모듈이 고수준 모듈에 의존한다는 것.

### 도메인 영역의 주요 구성요소

| 요소 | 설명 |
| :--- | :--- |
| 엔터티\(Entity\) | 고유의 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다. |
| 밸류\(Value\) | 고유의 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 도메인 객체의 속성을 표현할 때 사용된다. |
| 애그리거트\(Aggregate\) | 애그리거트는 관련된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다. |
| 리포지터리\(Repository\) | 도메인 모델의 영속성을 처리한다. |
| 도메인 서비스\(Domain service\) | 특정 엔티티에 속하지 않은 도메인 로직을 제공한다. |

#### 엔티티와 밸류

도메인 모델의 엔티티는 단순히 데이터를 담고 있는 데이터 구조라기보다는 데이터와 함께 기능을 제공하는 객체이다.

도메인 관점에서 기능을 구현하고 기능 구현을 캡슐화해서 데이터가 임의로 변경되는 것을 막는다.

도메인 모델의 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현할 수 있다.

#### 애그리거트

애그리거트는 관련 객체를 하나로 묶은 군집이다.

애그리거트를 사용하면 개별 객체가 아닌 관련 객체를 묶어서 객체 군집 단위로 모델을 바라볼 수 있게 된다. 즉 애그리거트는 군집에 속한 객체들을 관리하는 루트 엔티티를 갖는다.

#### 리포지토리

도메인 객체를 지속적으로 사용하려면 RDBMS, NoSQL, 로컬 파일과 같은 물리적인 저장소에 도메인 객체를 보관해야 한다.

엔티티나 밸류가 요구사항에서 도출되는 도메인 모델이라면 리포지터리는 구현을 위한 도메인 모델이다.

리포지터리는 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.

**응용서비스와 리포지터리의 연관**

* 응용서비스는 필요한 도메인 객체를 구하거나 저장할 때 리포지터리를 사용한다.
* 응용 서비스는 트랜잭션을 관리하는데, 트랜잭션 처리는 리포지터리 구현 기술에 영향을 받는다.
* 애그리거트는 저장하는 메서드
* 애그리거트는 루트 식별자로 애거리거트를 조회하는 메서드

### 요청 처리 흐름

### 인프라스트럭처 개요

인프라스트럭처는 표현 영역, 응용 영역, 도메인 영역을 지원한다. 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현기술, 보조 기능을 지원한다.

### 모듈 구성

모듈 구조를 얼마나 세분화해야 하는지에 대해 정해진 규칙은 없다. 단지, 한 패키지에 너무 많은 타입이 몰려서 코드를 찾을 때 불편한 정도만 아니면 된다. 개인적으로는 한 패키지에 가능하면 10개 미만으로 타입 개수를 유지하려고 노력한다. 이 개수가 넘어가면 모듈을 분리하는 시도를 해본다.

